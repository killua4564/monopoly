![](https://github.com/killua4564/monopoly/workflows/pylint/badge.svg)
![](https://github.com/killua4564/monopoly/workflows/pytest/badge.svg)
![](https://coveralls.io/repos/github/killua4564/monopoly/badge.svg?branch=main)

# Monopoly
## 概述
基於[實體玩具](#改編自實體大富翁)改編的電子版本大富翁

融入了股票、ETF 和稅務等生活要素

豐富許多更現實與複雜的玩法


## 配置參數
### DEBUG_MODE
除錯模式，布林預設 `true`

### PLAYER_DEFAULT_CASH
玩家初始金額，整數預設 `3600`

### PASS_START_POINT_CASH
經過起點獲得的金額，整數預設 `1000`

### CASH_SPACE_VALUE
增減存款格子的金額，整數預設 `1000`

### AREA_ADDITION_RATE
相同區域每多擁有一個土地的加成，浮點數預設 `0.25`

### UNLIMITED_BUILDING
是否可無限購買不動產，布林預設 `true`

### BUILDING_UPPERBOUND
可建造土地的建築上限，整數預設 `4`

### LAND_DISCOUNT_RATE
賣掉土地的折現率，浮點數預設 `1.0`

### HOUSE_DISCOUNT_RATE
賣掉房屋的折現率，浮點數預設 `0.9`

### STOCK_SHUFFLE_BASE
股票漲跌隨機值基數，整數預設 `100`

### GAME_SAVE_FOLDER
遊戲狀態儲存資料夾，字串預設 `save`

### GAME_SAVE_SUFFIX
遊戲狀態儲存副檔名，字串預設 `.sav`


## 遊戲財產介紹
### 國家、海洋
每個國家的土地(Land)都會伴隨一檔股票，並有以下屬性訊息
* `area`: 區域，預設以顏色區分
* `land_price`: 土地價格
* `house_price`: 房屋價格
* `tolls`: 過路費價格表

國家的財務狀況和房屋開發程度都會影響該股票的漲跌
* 買入/賣出土地
* 建造/拆除房屋
* 收取過路費

擁有國家的土地可以建造房屋
* 單次走訪到是否可以無限買入土地/建造房屋由 [`UNLIMITED_BUILDING`](#unlimited_building) 設定
* 建造上限為 [`BUILDING_UPPERBOUND`](#building_upperbound)
  * 若要設定 >4 則要擴充國家的過路費價格表

擁有海洋的土地(Ocean)不能建造房屋，但過路費價格為土地價格

若擁有相同區域的土地，則過路費會依照比例加成
* 過路費 = 土地過路費 $\*$ (1 $+$ (相同區域土地數 $-$ 1) $\*$ [`AREA_ADDITION_RATE`](#area_addition_rate))
* 備注: 海洋的區域為 `OCEAN`

每片土地/房屋賣出會受到折價影響
* 土地賣出價格 = 土地價格 $\*$ [`LAND_DISCOUNT_RATE`](#land_discount_rate)
* 房屋賣出價格 = 房屋價格 $\*$ [`HOUSE_DISCOUNT_RATE`](#house_discount_rate)


### 股票、ETF
每一檔個股(Stock)都相對應著一個國家，並有以下屬性訊息
* `beta`: 風險值 = 漲跌基數 $/$ 大富翁漲跌基數
* `esg_ratio`: ESG 分數率 = ESG 分數 $/$ ESG 分數滿分
* `payout_ratio`: 盈虧分配率 = 分配金額 $/$ 盈虧金額

在經過一輪玩家遊玩後，每檔個股都會進行隨機的漲跌
* 基數 = [`STOCK_SHUFFLE_BASE`](#stock_shuffle_base) $\*$ 風險值
* 每輪漲跌 = `random.randint(-基數, 基數)`

個股對應國家的財務狀況和房屋開發程度都會影響漲跌
* 收支漲跌 = 收入/支出金額 $\*$ 盈餘分配率
* 房屋漲跌 = [`STOCK_SHUFFLE_BASE`](#stock_shuffle_base) $\*$ 風險值 $\*$ ESG 分數率 $\*$ 房屋數量 $/$ [`BUILDING_UPPERBOUND`](#building_upperbound)

市場上目前有兩家 ETF 發行商，參照 [ETF 列表](#etf-列表)
* 大富翁投信: 針對個股的土地區域做直接平均發行
* [丟比](https://www.instagram.com/dubbit0923/)投信：針對個股的各種屬性做篩選並加權平均發行

每檔 ETF 皆有公開以下訊息
* `constituents`: 收錄的成分股和佔比 (無條件捨去到小數第二位)
* `expense_ratio`: 每輪扣繳的管理費用率 (無條件捨去到整數位)

每檔 ETF 會在個股完成漲跌後進行計算公允價格
* 每輪漲跌 = $\Sigma$(成分股漲跌 $\*$ 成分股比率)
* 每輪費用 = ETF 此輪價值 $\*$ ETF 管理費用率

每檔股票賣出時要繳交證券交易稅 (無條件捨去到整數位)
* 個股為總額的 3‰
* ETF 為總額的 1‰

每檔股票最多只能看前十輪的歷史

每檔股票皆有發行數量的限制


## 遊戲設備介紹
### 玩家
玩家名稱因應遊戲主板畫面格子大小，目前限制於六個字以內

玩家現金初始值為 [`PLAYER_DEFAULT_CASH`](#player_default_cash)

每輪玩家若沒有不可移動次數，則可選擇以下動作
* 投擲骰子
  * 正常狀態可選擇 1-2 顆骰子進行投擲(預設2)
  * 若有三顆骰子的狀態則可選擇 1-3 顆骰子進行投擲(預設3)
* 變賣資產
  * 這邊可選擇賣掉土地/拆掉房屋/賣出股票的動作
* 投降
  * 宣告投降以退出該遊戲

遊玩過程中會有些事件影響玩家所得累計和破產風險
* 經過格子直接獲得/損失的現金
* 藉由抽卡直接獲得的現金
* 收取/被收取過路費
* 繳交稅金/費用

每位玩家有兩個屬性決定是否可繼續遊玩(`playable`)
* `bankruptcy`: 破產
  * 在強制付款但是淨資產不足時觸發
  * 自動將身上所有資產進行變賣，並扣除應付金額
* `surrender`: 投降
  * 玩家自行選擇的動作，以不影響遊戲為原則
  * 不會變賣身上的任何資產，持續保持持有


### 格子空間
* `BaseSpace`: 格子共同屬性
  * `moving_point`: 移動點數，代表玩家在移入此格時需要消耗的骰子點數

* `StartPointSpace`: 起點
  * 抵達時可以選擇是否要翻轉遊戲主板的一切方向
  * 經過時可獲得現金和購買股票的權利
    * 金額由 [`PASS_START_POINT_CASH`](#pass_start_point_cash) 設定

* `LandSpace`: 土地格
  * 抵達時觸發購買/建造/收取過路費事件

* `CardSpace`: 卡片格
  * 抵達時觸發抽機會/命運卡片的事件

* `CashSpace`: 現金格
  * 抵達時觸發賺取/損失現金的事件
    * 金額由 [`CASH_SPACE_VALUE`](#cash_space_value) 設定

* `ThreeDicesSpace`: 骰子x3
  * 抵達時會在玩家身上附加可用三顆骰子的狀態
  * 下一次可擲骰子時自動使用
  * 狀態次數不得疊加 (尚未有疊加的情況)

* `PausePlayerSpace`: 暫停乙次
  * 抵達時會在玩家身上加上不可移動乙次
  * 不可移動次數可疊加 (尚未有疊加的情況)

* `TransportStartPointSpace`: 傳送起點
  * 抵達時玩家可選擇是否要傳送到起點
  * 若傳送到起點則視同於抵達起點


### 機會、命運卡片
共同卡片
* `CashCard`: 賺取/損失現金
  * 賺取(EARNING): 賺取現金，$500、$1000、$1500 各一張
  * 損失(COSTING): 損失現金，$300、$600、$900 各一張

機會(CHANCE)特有卡片
* `CashChanceCard`: 機會性賺取/損失現金
  * 賺取(EARNING): 表示場上尚未出局且現金最少玩家獲得金額，$1000 一張
  * 損失(COSTING): 表示場上尚未出局且現金最多玩家損失金額，$1000 一張

* `ForeclosePropertyCard`: 購買法拍不動產機會
  * 可在以下地點上以公允價格之 `80%` 購買土地/房屋
    * 未被擁有的土地購買土地
    * 自己擁有的土地購買房屋
  * 購買完成後不適用 [`UNLIMITED_BUILDING`](#unlimited_building) 狀態影響
  * 若購買的土地有對應的股票，則其同時以公允價格受到賺取財務的影響

* `FreeTollingCard`: 免付過路費
  * 獲得時會在玩家身上附加免付過路費的狀態
  * 遇到需要付過路費時自動使用(無法選擇是否使用)
  * 狀態次數不得疊加

* `ImposePropertyCard`: 向玩家徵收不動產機會
  * 可選擇其他玩家擁有的不動產以公允價格之 `110%` 進行徵收
  * 若選擇的土地上含有房屋則一併計算徵收價格
  * 若徵收玩家現金不足則只能放棄這次機會
  * 若無其他玩家擁有不動產則只能放棄這次機會
  * 徵收價格會計入被徵收玩家的所得
  * 無論被徵收的不動產是否有對應的股票，皆不受財務狀況的影響

* `ReturnToStartPointCard`: 返回起點
  * 此功能為強制性，無法選擇是否要返回
  * 返回起點後不會觸發抵達起點的功能

命運(COMMUNITY_CHEST)特有卡片
* `FreeBuildingCard`: 免費建造房屋機會
  * 可在擁有的土地上免費建造房屋乙棟
  * 若未擁有可建造房屋的土地則只能放棄這次機會
  * 建造完成後不適用 [`UNLIMITED_BUILDING`](#unlimited_building) 狀態影響

* `FreeIncomingCard`: 抽到免繳所得稅乙次
  * 清除玩家身上累計的所得

* `HouseTaxCard`: 繳交房屋稅
  * 需繳交擁有的房屋公允價值總和之 `3%`

* `IncomeTaxCard`: 繳交所得稅
  * 需繳交累積所得之 `5%`

* `LandValueTaxCard`: 繳交地價稅
  * 需繳交擁有的土地公允價值總和之 `1%`

* `StockHandlingFeeCard`: 繳交股票交易手續費
  * 需繳交擁有的股票公允價值總和之 `1.425‰`
  * 無論是否繳交過手續費，只要當下持有就會被收取乙次


## 遊戲主板介紹
每個遊戲主板負責一個整體遊戲的運行，紀錄著所需要的土地、股票、玩家、格子、卡片等要素

主板有幾個屬性來記錄起始物件，並記錄運行方向
* `start_player`: 第一位玩家
  * 當輪到玩家(`current_player`)為第一位玩家時會進行股票的開市
* `start_space`: 第一個格子
  * 在主板開始遊戲時會把所有玩家放到此格子上
* `direction`: 方向
  * 主板玩家和格子皆為雙向鏈結串列，此屬性決定遊戲運行方向

主板的 S/L 功能使用 `pickle` 套件
* 儲存的位置和副檔名由 [`GAME_SAVE_FOLDER`](#game_save_folder) 和 [`GAME_SAVE_SUFFIX`](#game_save_suffix) 定義

當贏家(`winner`)誕生時，會紀錄 `finished` 屬性以表示此主板遊戲結束
* 贏家為最後一個可繼續遊玩的玩家

目前只有一個遊戲主板，若有需要其他遊戲規則可依照邏輯繼續開發


## 遊戲引擎介紹
每個遊戲引擎負責提供運行/加載遊戲主板等介面

單機版引擎(StandAloneEngine)可提供玩家們在單機上加載/遊玩遊戲主板
* 當引擎出現未預期錯誤時，[`DEBUG_MODE`](#debug_mode) 控制是否要顯示錯誤細節

目前只有單機版引擎，之後預計開發可連線的引擎


## ETF 列表
### 大富翁投信
* 綠色地區
  1. 篩選區域為綠色的成分股
  2. 以市值做直接平均發行
* 紫色地區
  1. 篩選區域為紫色的成分股
  2. 以市值做直接平均發行
* 黑綠色地區
  1. 篩選區域為黑綠色的成分股
  2. 以市值做直接平均發行
* 橘色地區
  1. 篩選區域為橘色的成分股
  2. 以市值做直接平均發行
* 咖啡色地區
  1. 篩選區域為咖啡色的成分股
  2. 以市值做直接平均發行
* 棕色地區
  1. 篩選區域為棕色的成分股
  2. 以市值做直接平均發行
* 藍色地區
  1. 篩選區域為藍色的成分股
  2. 以市值做直接平均發行
* 紅色地區
  1. 篩選區域為紅色的成分股
  2. 以市值做直接平均發行

### 丟比投信
* 丟比肥嫩10
  1. 篩選市值高的 10 檔成分股
  2. 以市值做加權平均發行
* 丟比高股息
  1. 篩選盈虧分配率高的 5 檔成分股
  2. 以盈虧分配率做加權平均發行
* 丟比高息低波
  1. 篩選風險值低的 10 檔成分股
  2. 篩選盈虧分配率高的 5 檔成分股
  3. 以盈虧分配率做加權平均發行
* 丟比肥嫩ESG
  1. 篩選 ESG 分數率高的 5 檔成分股
  2. 以市值做加權平均發行
* 丟比中小10
  1. 篩選市值高的 20 檔成分股
  2. 篩選市值低的 10 檔成分股
  3. 以市值做加權平均發行
* 丟比肥胖15
  1. 篩選市值高的 15 檔成分股
  2. 以市值做加權平均發行
* 丟比肥胖30
  1. 以市值做加權平均發行
* 丟比低價低波
  1. 篩選風險值低的 15 檔成分股
  2. 篩選市值低的 10 檔成分股
  3. 以市值做加權平均發行
* 丟比永續高息
  1. 篩選 ESG 分數率高的 15 檔成分股
  2. 篩選盈虧分配率高的 10 檔成分股
  3. 以盈虧分配率做加權平均發行
* 丟比肥胖高息
  1. 篩選盈虧分配率高的 10 檔成分股
  2. 以盈虧分配率做加權平均發行


## 實體大富翁
基於此實體大富翁玩具進行改編
* 名稱: (粉Q)大富翁世界之旅
* 製造商: 福州亞灣文具有限公司
* 進口商: 亞灣文具股份有限公司
* 貨號: A784
* 條碼: 4713774107849
